#!/usr/bin/python3

import os
import random
import subprocess

i2cbus = str(1) #strval of the i2c bus, not the address
i2caddress = '0x3c' #i2c device address, i2cdetect to figure it out


def runi2cset(iter, bang1, bang2):
        global i2cbus, i2caddress
        for i in range(1,iter):
                proc = subprocess.Popen(['i2cset', '-y', i2cbus, i2caddress, bang1, bang2], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
                stdout, stderr = proc.communicate()
                        #print(stdout)
                        #print(stderr)
def rescursor():
        runi2cset(2, '0x00', '0x21') # set screen width
        runi2cset(2, '0x00', '0x00') # screen width start
        runi2cset(2, '0x00', '0x7F') # screen width end (128)
        runi2cset(2, '0x00', '0x22') # set screen height
        runi2cset(2, '0x00', '0x00') # screen height start line
        runi2cset(2, '0x00', '0x07') # screen height end line (7 for 128x64)

def initscreen():
        runi2cset(2, '0x00', '0xAF')
        runi2cset(2, '0x00', '0xA8')
        runi2cset(2, '0x00', '0x3F')
        runi2cset(2, '0x00', '0xD3')
        runi2cset(2, '0x00', '0x00')
        runi2cset(2, '0x00', '0x40')
        runi2cset(2, '0x00', '0xA1')
        runi2cset(2, '0x00', '0xC8')
        runi2cset(2, '0x00', '0xDA')
        runi2cset(2, '0x00', '0x32')
        runi2cset(2, '0x00', '0xA4')
        runi2cset(2, '0x00', '0xA6')
        runi2cset(2, '0x00', '0xD5')
        runi2cset(2, '0x00', '0x80')
        runi2cset(2, '0x00', '0x8D')
        runi2cset(2, '0x00', '0x14')
        runi2cset(2, '0x00', '0x20')
        runi2cset(2, '0x00', '0x20')
        rescursor()


def fillscreen():
        runi2cset(1025, '0x40', '0x2E') #iter + 1

def clearscreen():
        runi2cset(1025, '0x40', '0x0') #iter + 1

def weirdtests():
        temparray = []
        for i in range(1,128):
                temparray.append(i)
        for i in range(1, len(temparray)):
                thisone = random.choice(temparray)
                runi2cset(2, '0x40', str(hex(thisone)))

def fontsupply(inputstring):
        systemfont = [
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','00','00','00'],
        ['00','00','5F','00','00'],
        ['00','07','00','07','00'],
        ['14','7F','14','7F','14'],
        ['24','2A','7F','2A','12'],
        ['23','13','08','64','62'],
        ['36','49','55','22','50'],
        ['00','05','03','00','00'],
        ['00','1C','22','41','00'],
        ['00','41','22','1C','00'],
        ['08','2A','1C','2A','08'],
        ['08','08','3E','08','08'],
        ['00','50','30','00','00'],
        ['08','08','08','08','08'],
        ['00','60','60','00','00'],
        ['20','10','08','04','02'],
        ['3E','51','49','45','3E'],
        ['00','42','7F','40','00'],
        ['42','61','51','49','46'],
        ['21','41','45','4B','31'],
        ['18','14','12','7F','10'],
        ['27','45','45','45','39'],
        ['3C','4A','49','49','30'],
        ['01','71','09','05','03'],
        ['36','49','49','49','36'],
        ['06','49','49','29','1E'],
        ['00','36','36','00','00'],
        ['00','56','36','00','00'],
        ['00','08','14','22','41'],
        ['14','14','14','14','14'],
        ['41','22','14','08','00'],
        ['02','01','51','09','06'],
        ['32','49','79','41','3E'],
        ['7E','11','11','11','7E'],
        ['7F','49','49','49','36'],
        ['3E','41','41','41','22'],
        ['7F','41','41','22','1C'],
        ['7F','49','49','49','41'],
        ['7F','09','09','01','01'],
        ['3E','41','41','51','32'],
        ['7F','08','08','08','7F'],
        ['00','41','7F','41','00'],
        ['20','40','41','3F','01'],
        ['7F','08','14','22','41'],
        ['7F','40','40','40','40'],
        ['7F','02','04','02','7F'],
        ['7F','04','08','10','7F'],
        ['3E','41','41','41','3E'],
        ['7F','09','09','09','06'],
        ['3E','41','51','21','5E'],
        ['7F','09','19','29','46'],
        ['46','49','49','49','31'],
        ['01','01','7F','01','01'],
        ['3F','40','40','40','3F'],
        ['1F','20','40','20','1F'],
        ['7F','20','18','20','7F'],
        ['63','14','08','14','63'],
        ['03','04','78','04','03'],
        ['61','51','49','45','43'],
        ['00','00','7F','41','41'],
        ['02','04','08','10','20'],
        ['41','41','7F','00','00'],
        ['04','02','01','02','04'],
        ['40','40','40','40','40'],
        ['00','01','02','04','00'],
        ['20','54','54','54','78'],
        ['7F','48','44','44','38'],
        ['38','44','44','44','20'],
        ['38','44','44','48','7F'],
        ['38','54','54','54','18'],
        ['08','7E','09','01','02'],
        ['08','14','54','54','3C'],
        ['7F','08','04','04','78'],
        ['00','44','7D','40','00'],
        ['20','40','44','3D','00'],
        ['00','7F','10','28','44'],
        ['00','41','7F','40','00'],
        ['7C','04','18','04','78'],
        ['7C','08','04','04','78'],
        ['38','44','44','44','38'],
        ['7C','14','14','14','08'],
        ['08','14','14','18','7C'],
        ['7C','08','04','04','08'],
        ['48','54','54','54','20'],
        ['04','3F','44','40','20'],
        ['3C','40','40','20','7C'],
        ['1C','20','40','20','1C'],
        ['3C','40','30','40','3C'],
        ['44','28','10','28','44'],
        ['0C','50','50','50','3C'],
        ['44','64','54','4C','44'],
        ['00','08','36','41','00'],
        ['00','00','7F','00','00'],
        ['00','41','36','08','00'],
        ['08','08','2A','1C','08'],
        ['08','1C','2A','08','08'],
        ['00','06','09','09','06']]
        print(len(systemfont))
        ordarray = []
        outarray = []
        stringlen = len(inputstring)
        for char in range(0, stringlen):
                ordarray.append(ord(inputstring[char]))
        print(ordarray)
        for charnum in ordarray:
                for i in range(0, 5):
                        thischar = '0x' + str(systemfont[charnum][i])
                        outarray.append(thischar)
        return outarray


def writetext(text):
        for i in fontsupply(text):
                runi2cset(2, "0x40", i)


#MAIN STARTS HERE------------------------------------------------------


initscreen()
#fillscreen()
rescursor()
clearscreen()
rescursor()
writetext("Much better")
